{% if include.lookup %}
  {% assign member = site.members 
    | where_exp: "member", "member.slug == include.lookup"
    | first
  %}
{% else %}
  {% assign member = include %}
{% endif %}

{% assign type = site.data.types[member.role] %}

{%- comment -%} 옵션 추가: 링크 끄기 / 아이콘 숨기기 {%- endcomment -%}
{% assign nolink    = include.nolink    | default: false %}
{% assign show_icon = include.show_icon | default: true  %}

<div class="portrait-wrapper">
  {% if nolink %}
    <div class="portrait" data-style="{{ include.style }}"
         aria-label="{{ member.name | default: "member" | regex_strip }}">
  {% else %}
    <a {% if page.slug != member.slug %}href="{{ member.url | relative_url | uri_escape }}"{% endif %}
       class="portrait" data-style="{{ include.style }}"
       aria-label="{{ member.name | default: "member link" | regex_strip }}">
  {% endif %}

    {% if show_icon and type %}
      {% include icon.html icon=type.icon %}
    {% endif %}

    <img
      src="{{ member.image | relative_url | uri_escape }}"
      class="portrait-image"
      alt="member portrait"
      loading="lazy"
      {% include fallback.html %}
    >


    
    {% if member.name %}
      <span class="portrait-name">
        {{ member.name }}
      </span>
    {% endif %}

    {% if member.description or type %}
      <span class="portrait-description">
        {{ member.description | default: type.description | markdownify | remove: "<p>" | remove: "</p>" }}
      </span>
    {% endif %}

    {% if member.affiliation %}
      <span class="portrait-affiliation">
        {{ member.affiliation }}
      </span>
    {% endif %}

  {% if nolink %}
    </div>
  {% else %}
    </a>
  {% endif %}
</div>

